<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><!-- InstanceBegin template="/Templates/main.dwt" codeOutsideHTMLIsLocked="false" -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<!-- InstanceBeginEditable name="title" -->
<title>Strawberry Perl for Windows - Documentation - Merge Module</title>
<!-- InstanceEndEditable -->
<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="http://strawberryperl.com/favicon.ico">
<link rel="stylesheet" type="text/css" href="http://strawberryperl.com/common.css">
<link rel="stylesheet" type="text/css" href="http://strawberryperl.com/main.css">
<!-- InstanceBeginEditable name="head" --><!-- InstanceEndEditable -->
</head>
<body>
<!-- InstanceBeginEditable name="body" -->
<a href="index.html"><img src="http://strawberryperl.com/images/1036400_58384714.jpg" alt="Strawberry Perl Home" width="246" height="521" hspace="0" vspace="20" border="0" align="right"></a>
<h1>Building your own "strawberry-like"<br>perl distribution (via MSM merge module)</h1>
<table border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td>
	<h2>What do I need?</h2>
          <p>Start with an installation of any version of Strawberry Perl 5.12.x (or higher). <b>BEWARE:</b>You'll need to install Strawberry Perl to a directory OTHER THAN C:\strawberry.</p>
	  <p>Install WiX-3.0 installer from <a href="http://wix.sourceforge.net/downloadv3.html">http://wix.sourceforge.net/downloadv3.html</a></p>
          <p>Install 4 modules, in this order:<br />
	  <ul>
		<li><a href="http://search.cpan.org/perldoc?Perl::Dist::WiX">Perl::Dist::WiX</a> (you will probably need <a href="http://svn.ali.as/cpan/trunk/Perl-Dist-WiX/">the latest svn version</a>)</li>
		<li><a href="http://search.cpan.org/perldoc?Perl::Dist::WiX::BuildPerl::5142">Perl::Dist::WiX::BuildPerl::5142</a>(you will probably need <a href="http://svn.ali.as/cpan/trunk/Perl-Dist-WiX-BuildPerl-5142/">the latest svn version</a>)</li></li>
                <li><a href="http://search.cpan.org/perldoc?Perl::Dist::Strawberry">Perl::Dist::Strawberry</a> (you will probably need <a href="http://svn.ali.as/cpan/trunk/Perl-Dist-Strawberry/">the latest svn version</a>)</li></li>                
	  </ul>
        <h2>What do I do after everything's installed?</h2>
	<p>There are two more things to do:<br />
	  <ul>
            <li>Create a script - let's call it build_perl.pl - like this:</li>
	  <pre>
package CustomPerlBuild;

use strict;
use warnings;
use File::Temp;
use File::Spec::Functions  qw( catdir catfile );
use File::Slurp            qw( write_file );
use parent 'Perl::Dist::Strawberry';

sub new {
  my ($class, $workdir) = @_;  
  die "FATAL: workdir name must be defined and can't contain spaces" if !$workdir || $workdir =~ / /;
  my %args = (
    # Set this to 2 for now. You can set it to 1 later.
    trace                => 2,
    temp_dir             => $workdir,
    image_dir            => catdir($workdir, 'strawberry'),
    perl_version         => '5142',
    # Change these as appropriate for what you want to call your distribution.
    app_publisher_url    => 'http://publisher.website.invalid/',
    app_id               => 'customperl',
    app_name             => 'Custom Perl',
    app_publisher        => 'Publisher Name',
    build_number         => 11, #the 4th digit in version 5.14.2.<build_number>
    # These are the locations to pull down the msm. 
    bits                 => 32, #32|64 - should correspond to chosen MSM
    msm_to_use           => 'http://strawberryperl.com/package/kmx/p5.14.2.1-RC/strawberry-perl-5.14.2.1-32bit.msm',
    msm_zip              => 'http://strawberryperl.com/package/kmx/p5.14.2.1-RC/strawberry-perl-5.14.2.1-32bit.zip',
    msm_code             => '72014D7D-5EC7-3665-9F97-959C988CA754',
    fileid_perl          => 'F_exe_MzA1Mjk2NjIyOQ',
    fileid_relocation_pl => 'F_tab_Mzg0NDgwNzYyMQ',
    # Tasklist
    tasklist => [
      'final_initialization',
      'initialize_using_msm',
      'install_extra_modules',
      'install_win32_extras',
      'install_strawberry_extras',
      'install_relocation_information',
      'remove_waste',
      'install_readme',
      'regenerate_fragments',
      'write',
    ],
  );
  return $class->SUPER::new( \%args );
}

sub install_readme {  # README.txt is mandatory, must be included into Win32Extras fragment
  my $self = shift;
  write_file( $self->file('README.txt'), <<MARKER);
This is readme file for Custom Perl distribution.

Put here whatever you need to.
MARKER
  $self->add_to_fragment('Win32Extras', [$self->file('README.txt')]);
}

sub install_extra_modules {
  my $self = shift;
  #$self->install_module( name=>'YAML::XS' );        
  $self->install_module( name=>'Spreadsheet::ParseExcel', follow_deps=>1, force=>1 );
}

sub _build_output_base_filename { # the output filename for ZIP/MSI e.g. 'customperl-5.14.2.11-20111124-32bit'
  my $self = shift;
  my $string = $self->app_id . '-'
             . $self->perl_version_human . '.'
             . $self->build_number . '-'
             . $self->output_date_string . '-'
             . $self->bits . 'bit';
  return $string;
}
	  
package main;

my $dist = CustomPerlBuild->new( 'c:\buildtmp' );
$dist->run();
	  </pre>
          <li>Run build_perl.pl + wait a few minutes, and you're done.</li>
	  </ul></p>
	  <p>If you want to do more complicated things than just add additional modules, read the Perl::Dist::WiX documentation, and then e-mail us and we'll do our best to help you out.</p>
    </td>
  </tr>
</table>

<!-- Start Quantcast tag -->
<script type="text/javascript">
_qoptions={
qacct:"p-44rvHMFUvK7tg"
};
</script>
<script type="text/javascript" src="http://edge.quantserve.com/quant.js"></script>
<noscript>
<img src="http://pixel.quantserve.com/pixel/p-44rvHMFUvK7tg.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
</noscript>
<!-- End Quantcast tag -->

<!-- InstanceEndEditable -->
</body>
<!-- InstanceEnd --></html>
